------

## vim 编辑器

初学 vi/vim，应该通过学习附属 vim 安装的 vimtutor （或 vimtutor zh）来对 vim 各方面有个初步的了解。

VIM 官网：https://www.vim.org/
VIM 帮助页面：https://vimhelp.org/

以下节选为可在较多环境下使用的功能，应该根据自己的需求做相应的整理或增删。

Vim 的几种模式

```
普通模式：可以使用操作符、快捷键命令。在其它模式下按 ESC 可以返回普通模式。
底部命令模式：可在普通模式/可视模式下使用 : 、\ 或 ? 执行命令或临时配置 vim。
替换模式：在普通模式下，按 R 等进入。
插入模式：在普通模式下，按 i 等进入。
可视模式：在普通模式下，按 v 等进入，以区块高亮选择文本。
```

------

### 普通模式（Normal mode）

#### 光标定位或操作符作用域

```
h，j，k，l		/* 左、下、上、右移。
gj, gk		/* 自动换行的行间下，上移动。

{ [ home | 0 | ^ ] | [ end | $ ] }	/* 行首/首字符/行尾；
{ gg | G }		/* 首行/末行；

{ w | W }		/* 右移一个单词/字符串位，光标停在首字符；
{ b | B }		/* 左移一个单词/字符串位，光标停在首字符；
{ e | E }		/* 右移一个单词/字符串位，光标停在尾字符；
{ ge | gE }		/* 左移一个单词/字符串位，光标停在尾字符；

/* 移动到当前行 char 字符位/前，如再输入分号（;），则移动到下一个匹配位。
{ f|tchar }
{ F|Tchar }		/* 同上，只是反向。

注：改变、剪切和复制命令称作操作符，可在操作符前指定数字倍数，有时也可在作用域前指定数字倍数。
    [数字倍数] 操作符 作用域 （字段间没有空格）

    但在可视模式下，则操作符必须在最后面。
    可视模式 [数字倍数] 作用域 （字段间没有空格）

[ nG | ngg ]		/* 移动到第 n 行。
{ H | M | L }		/* 移动到屏幕页首/页中/页尾。

ctrl + G		/* 显示当前编辑状态，包含文件名和光标位置。
```

------

### 可视模式（Visual mode）:

```
普通模式按 v 进入可视模式, 高亮选取文本；
普通模式按 V，高亮按行选取；
普通模式按 ctrl + v，高亮按块选取。
```

文本块

```
{ aw | as | ap }	/* 一个词/一句/一段。

{ ab | ib | aB | iB }	/* 小括号块/不含括号/花括号块/不含花括号。

%			/* 小、方、花括号。

可视模式 [数字倍数] [作用域 | 文本块] [操作符] （字段间没有空格）

普通模式 [数字倍数] [操作符] [作用域 | 文本块] （字段间没有空格）

```

注：可视模式下选取文本后，`:w filename` 保存所选内容到指定文件。

------

### 插入模式（Insert mode）

```
i | I | a | A		/* 在所在字符/行首字符/下一个字符/行尾进入插入模式。
o | O			/* 在下/上一行插入。
```

------

### 替换模式（Replace mode）

```
r			/* 替换光标处的字符，替换后自动返回到普通模式。
R			/* 进入替换模式，按 esc 返回到普通模式。
```

------

### 操作符（Operator）

改变/剪切/复制/粘贴:

```
c、d、y			/* 分别为改变、剪切和复制操作符。

{ p | P }		/* 粘贴到所在行下/上。

可视模式 [数字倍数] [作用域 | 文本块] [操作符] （字段间没有空格）

普通模式 [数字倍数] [操作符] [作用域 | 文本块] （字段间没有空格）

{ yy | [ dd | D ] }	/* 复制/删除（剪切）所在行。
[n]dd			/* 删除（剪切）n 行。
```

------

### 撤消与重做（Undo and redo）

```
U			/* 撤销在当前行中所作的所有改动。
[n]u			/* 撤销 n 个改动。
:undo 5			/* 撤销 5 个改变。
:undolist		/* 撤销历史。

.			/* 重复上一次操作。
ctrl + r		/* 反撤销。

:earlier 9m		/* 回到 9 分钟前。
:later 18s		/* 前进 18 秒。
```

------

### 底部命令模式（Command at bottom mode）

我们常在底部命令模式来执行文本替换、查找、设置和查看配置及其它各种功能。在输入 `:` 、`/` 或 `?` 后，可以使用上下键切换之前的执行过的指令。

#### 匹配搜索（Searching with matching）

```
/keyword		/* 向上查找 keyword， n 下一个； N 前一个。
?keyword		/* 向下查找 keyword， n 下一个； N 前一个。
	\<keyword	/* 仅匹配与 keyword 同样开头的单词。
	keyword\>	/* 仅匹配与 keyword 同样结尾的单词。
	\<keyword\>	/* 仅匹配与 keyword 完全一样的单词。

/* 非底部命令模式的快捷命令查找。
%		/* 光标停在单个任意括号字符下，按 % 查找配对的括号。
{ * | # }	/* 在任何单词下按 */# 号，则向下/上查找此单词。
```

------

#### 匹配替换（Substituting with matching）

```
:s/old/new		/* 在当前行用 new 替换第一个 old。
:s/old/new/g		/* 在当前行用 new 替换所有的 old。
:n1,n2s/old/new/g	/* 在 n1 和 n2 用 new 替换所有的 old。
:%s/old/new/g		/* 用 new 替换文件中所有的 old。
:%s/old/new/gc		/* 同上，但每次替换都提示确认。

:%s/^/#/g		/* 在每一行的行首插入 #，^ 表示行首。
:%s/$/./g		/* 在每一行的行尾插入 .，$ 表示行尾。
```

------

#### 综合命令（Other various commands）

```
:help		/* 帮助手册页，文档最前部描述了如何快速使用帮助。

:! command		/* 执行 Linux 命令。
:m,nw !cmd	/* 以文件 m 至 n 行之间的内容作为命令的参数执行命令。

:m,nd			/* 剪切 m 到 n 行的内容。

:r filename		/* 在光标处插入指定文件的内容。
:r !command		/* 在光标处插入命令的输出。

:e[dit] filename	/* 载入指定文件。
:e[dit]! filename	/* 强制放弃当前的修改，并载入指定的文件。

:pwd			/* 显示 vim 工作目录。
:cd path		/* 改变 vim 工作目录。

:f[ile]			/* 显示当前编辑状态。等同 ctrl + G。
:f[ile] filename	/* 把当前文件名设为指定文件名（仅在缓存中）。
:files			/* 显示所有打开的文件，包含缓存中的。
```

------

#### 文档保存/退出

```
{ :w | :w filename }	/* 保存/按指定文件名保存。
{ :q | :q! }		/* 退出/强行退出。
{ :wq | :wq! }		/* 保存并退出/强行退出。
```

------

### 常用设置

```
/* 列表选项。
:se[t]			/* 显示所有与默认设置不同的设置。
:se[t] all		/* 显示所有选项，但不包括终端选项。
:se[t] termcap	/* 显示所有终端选项，但不显示 GUI 中的 key codes。
:se[t] {option}?	/* 显示指定选项的值。

/* 设置选项为默认值。
:se[t] {option}&	/* 重置指定选项为默认值。
:se[t] {option}&vi	/* 重置指定选项为 vi 默认值。
:se[t] {option}&vim	/* 重置指定选项为 vim 默认值。
:se[t] all&		/* 重置所有选项为默认值。

/* 关闭或反转选项。
:se[t] no{option}	/* 关闭指定选项。
:se[t] {option}! | inv{option}		/* 切换或反转指定选项值。

/* 开启选项。
:se[t] {option}
	ru[ler]		/* 开启在右下角显示光标位置。
	showcmd		/* 开启显示输入的命令。位于 ruler 左边。

	nu[mber]	/* 开启显示行号。
	list		/* 开启显示非打印字符。

	[ic | ignorecase]	/* 开启忽略大小写。
	hlsearch		/* 开启高亮搜索。
	incsearch		/* 开启搜索输入同步。
	[ws | wrapscan]		/* 开启文件滚动搜索。

	[ai | autoindent]	/* 开启自动缩进。
	[si | smartindent]	/* 开启智能缩进。必须开启 autoindent。

	autochdir		/* 根据所编辑文件的位置自动切换 vim 工作目录。

:set softtabstop=4		/* 用以指定数量的空格代替 TAB 制表符。

/* 设置文档宽度（默认为 0，也就是 80 字符单位），达限后自动加换行。
:set textwidth=0
:syn[tax] on | off		/* 开启/关闭语法高亮。
```

------

### VIM 配置

```
/etc/vimrc		/* VIM 的系统配置文件。
~/.vimrc		/* VIM 的个人配置文件。

:scriptnames		/* 列表所有的 VIM 配置文件，插件。
```

------

### 多窗口

```
:sp[lit] filename	/* 水平分割窗口，并在新窗口打开指定文件。
:vs[plit] filename	/* 垂直分割窗口，并在新窗口打开指定文件。

Ctrl + w	/* 窗口操作。
	s		/* 水平分割窗口。
	v		/* 垂直分割窗口。
	w		/* 切换窗口。
	q		/* 退出光标所在窗口。
	x		/* 与下一个窗口交换位置。
	=		/* 使所有窗口的高和宽相等。
```

------

### 寄存器（Register）

用寄存器来保存剪切、复制或粘贴的内容，并可应用到以后的操作。

```
:reg		/* 列表所有寄存器，及其内容。

/* 具名寄存器。

"a-z		/* 在剪切、复制或粘贴前都可以使用 a-z 有名寄存器。
"A-Z		/* 用大写字母 A-Z 表示在相应的寄存器中追加内容。

""		/* 默认寄存器，每次使用 c，d，y，p 的内容。

/* 无名寄存器。

"0		/* 保存最新复制的内容。
"1-9		/* c，d，y，p 操作记录序列。

/* 只读寄存器。

".		/* 最后插入的文本。
"%		/* 当前文件名。
":		/* 最近执行的命令。
"#		/* 替代的文件名。

/* 其它寄存器

"-		/* 最近小于一行的删除。
"/		/* 最近的搜索匹配。
"=		/* 最近的表达式扩展。
"_		/* 黑洞寄存器（在命令前使用此寄存器，则在寄存器中不被记录）。
"*		/* 系统剪贴版（X11 primary）。 
"+		/* 系统剪贴板（X11）。
```

------

### 标记（mark）

在 VIM 中，除了短距离的移动，如上下左右，按词，fchar 等移动之外，都属于跳跃。每一次跳跃都会按序记录下来，并且可以指定跳转到指定的记录点，每个记录点也可以称为标记。

无名标记
```
/* 列表记录的跳跃记录。在列表条目中首字符若为 <，则表示当前所在跳跃。
:jumps

ctrl + O		/* 返回到跳跃记录中的上一个跳跃点。
{ctrl + I | TAB}	/* ctrl + O 的反向操作。
``			/* 前一个跳跃点，但仅在两个跳跃点之间来回跳跃。
```

`m` 为标记指令，共可指定 26 标记，字母 a - z。

具名标记
```
:marks			/* 列表具名标记。
/* 列表条目中的特殊字符。
     `			/* 光标所在位置。
     "			/* 文件编辑的最后所在位置。
     [			/* 最后一次修改的起始位置。
     ]			/* 最后一次修改的结束位置。

m[a-z]			/* 生成具名标记。
`[a-z]			/* 跳跃到指定具名标记。
```

------

### 排版

请先查阅文档介绍以方便理解以下快捷方式。https://vimhelp.org/usr_25.txt.html#usr_25.txt 或 `:help set` + `/usr_25.txt` + `ctrl + ]`。


#### 基本排版

文本缩进。
```
{<< | >>}	/* 左/右缩进。
```

对齐方式。
```
:{range}ce(nter) [width]	/* 所选行文字居中。
:{range}ri(ght) [width]		/* 所选行文字右对齐。
:{range}le(ft) [margin]		/* 所选行文字左对齐。

{range} 为 m,n ，也就是起始行至结束行的文本范围。[width] 为宽度，默认为 textwidth 值，[margin] 是以空格为单位的边距。

注：文本对齐会影响文本两端原有的空格和制表符。
```


行拼接。
```
J	/* 行拼接，去掉原行间空格再添加一个空格，默认拼接下行。
gJ		/* 直接去掉行间换行符。
```

重排行，即对过长的文字进行断行。
```
gq
  q		/* 重排所在行。

可视模式 [所选区域] gq （字段间没有空格）
```

------

### 小技巧

复制列
```
	title    column 1    column 2    column3
        a          1            2          3
        b          2            2          3
        c

/* 复制第三列到第一列前。
1. :set virtualedit=all
2. 手动选取要复制的区块的行数和列数，或 [ctrl + v] + 3j + l11 + y。 
3. 移动至要复制地起始位置，按 P。
4. :set virtualedit=  ，恢复至初始设置。
```

导入文本后，处理文本的两个奇妙代码。
```
:g/./,/^$/join

:g/\S/,/^\s*$/join
```

------
